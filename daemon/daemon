#!/bin/bash

if [ -h /etc/systemd/system/callmonitor ]
then
	/bin/systemctl start callmonitor.service
else
	/bin/cat > /etc/systemd/system/callmonitor.service <<EOF
[Unit]
Description=the fritzlox callmonitor service

[Service]
Type=oneshot
RemainAfterExit=yes
#if type=oneshot and RemainAfterExit=yes is not set, then the script stops immediately!
EnvironmentFile=-/etc/environment
WorkingDirectory=REPLACELBHOMEDIR/webfrontend/htmlauth/plugins/REPLACELBPPLUGINDIR/bin
ExecStart=REPLACELBHOMEDIR/webfrontend/htmlauth/plugins/REPLACELBPPLUGINDIR/bin/callmonitor >> REPLACELBHOMEDIR/log/plugins/REPLACELBPPLUGINDIR/callmonitor.log

[Install]
WantedBy=multi-user.target
EOF
	/bin/systemctl daemon-reload
	/bin/systemctl start callmonitor
fi